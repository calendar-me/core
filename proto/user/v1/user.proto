syntax = "proto3";
package user.v1;

import "common/v1/request.proto";
import "common/v1/response.proto";
import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "user/v1/role.proto";

/* model */
message User {
  enum Gender {
    GENDER_UNSPECIFIED = 0;
    GENDER_MALE = 1;
    GENDER_FEMALE = 2;
  }

  message Details {
    string firstname = 1;
    string lastname = 2;
    string avatar = 3;
    string phone = 4;
    Gender gender = 5;
  }

  string id = 1;
  string email = 2;
  optional Details details = 3;
}

/* filters */
message UsersFilter {
  repeated string ids = 1;
  optional common.v1.QueryParams params = 2;
}

service UserService {
  rpc GetUsers(GetUsersRequest) returns (GetUsersResponse) {
    option (google.api.http) = {get: "/users"};
  }
  rpc GetUser(GetUserRequest) returns (GetUserResponse) {
    option (google.api.http) = {get: "/users/{id}"};
  }
  rpc GetCurrentUser(google.protobuf.Empty) returns (GetCurrentUserResponse) {
    option (google.api.http) = {get: "/users/me"};
  }

  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse) {
    option (google.api.http) = {
      put: "/users/{id}"
      body: "request"
    };
  }
  rpc DeleteUser(DeleteUserRequest) returns (common.v1.BoolResponse) {
    option (google.api.http) = {delete: "/users/{id}"};
  }

  rpc GetRoles(GetRolesRequest) returns (GetRolesResponse) {
    option (google.api.http) = {get: "/users/{id}/roles"};
  }
  rpc GrantRoles(GrantRolesRequest) returns (common.v1.BoolResponse) {
    option (google.api.http) = {
      post: "/users/{id}/roles/grant"
      body: "roles"
    };
  }
  rpc RevokeRoles(RevokeRolesRequest) returns (common.v1.BoolResponse) {
    option (google.api.http) = {
      post: "/users/{id}/roles/revoke"
      body: "roles"
    };
  }
}

message GetUsersRequest {
  UsersFilter filters = 1;
}
message GetUsersResponse {
  repeated User users = 1;
}

message GetUserRequest {
  string id = 1;
}
message GetUserResponse {
  User user = 1;
}

message GetCurrentUserResponse {
  User user = 1;
}

message UpdateUserRequest {
  string id = 1;
  User.Details request = 2;
}
message UpdateUserResponse {
  User user = 1;
}

message DeleteUserRequest {
  string id = 1;
}

message GetRolesRequest {
  string id = 1; // user's id
  optional string business_id = 2 [json_name = "business_id"];
  optional string service_id = 3 [json_name = "service_id"];
}
message GetRolesResponse {
  repeated Role roles = 1;
}

message GrantRolesRequest {
  string id = 1;
  repeated Role roles = 2;
}
message RevokeRolesRequest {
  string id = 1;
  repeated Role roles = 2;
}
